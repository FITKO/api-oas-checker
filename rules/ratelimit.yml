rules:
  missing-retry-after:
    description: |-
      When a client is either:
      * throttled out with a 429 status code;
      * warned about a temporary server issue with a 503 status code;
      the server should explicitly communicate how long to wait
      before issuing further requests using the Retry-After header.
    message: >-
      Missing ratelimit header: {{property}} in {{path}}
    formats:
      - oas3
    severity: warn
    recommended: true
    given: >-
      $.[responses][?(@property == "429" || @property == "503"  )][headers]
    then:
      field: Retry-After
      function: truthy
  missing-ratelimit:
    x-tags:
    - it
    description: |-
      APIs should use ratelimit headers at least on successful responses.
    message: >-
      Missing ratelimit headers. {{property}} {{error}} {{path}}
    formats:
      - oas3
    severity: warn
    recommended: true
    given: >-
      $.[responses][?(@property[0] == "2" )][headers]
    then:
    - functionOptions:
        properties:
        -  X-RateLimit-Limit
        -  RateLimit-Limit
      function: xor
    - functionOptions:
        properties:
          - X-RateLimit-Remaining
          - RateLimit-Remaining
      function: xor
    - functionOptions:
        properties:
          - X-RateLimit-Reset
          - RateLimit-Reset
      function: xor